<Html>

<head>
    <script>
        function httpGetAsync(theUrl, callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                    callback(xmlHttp.responseText, xmlHttp.status);
            }
            xmlHttp.open("GET", theUrl, true); // true for asynchronous 
            xmlHttp.send(null);
        }
    </script>
</head>

<body>
    <div id="tarifrechner">
        <section id="input">
            <script>
                function doRequest(plz, consumption) {
                    httpGetAsync(`/rates?zipCode=${plz}&consumption=${consumption}`, (text, status) => {
                        if (status == 200) {
                            const tarife = JSON.parse(text);
                            console.log(tarife);
                            if (tarife.length > 0) {
                                function createHeadding(name) {
                                    const h = document.createElement("th");
                                    h.innerText = name;
                                    return h;
                                }
                                document.getElementById("output").innerHTML = "";
                                const table = document.createElement("table");
                                const headding = document.createElement("tr");
                                headding.appendChild(createHeadding("Name"));
                                headding.appendChild(createHeadding("Jahrespreis"));
                                headding.appendChild(createHeadding("Fixkosten"));
                                headding.appendChild(createHeadding("Preis kW/h"));
                                table.appendChild(headding);
                                tarife.forEach(element => table.appendChild(createItem(element)));
                                document.getElementById("output").appendChild(table);
                            } else {
                                document.getElementById("output").innerText = "Keine Daten für die eingegebe PLZ";
                            }
                        } else {
                            document.getElementById("output").innerText = "Keine Informationen für die eingegeben Daten vorhanden";
                        }
                    });
                }
                /**
                 * Erstelle einen Eintrag für einen Tarif und gebe ihn zurück.
                 * @param {Object} element 
                 * @return {Node}
                */
                function createItem(element){
                    function createTd(value) {
                        const td = document.createElement("td");
                        td.innerText= value;
                        return td;
                    }
                    let tr = document.createElement("tr");
                    tr.appendChild(createTd(element.title));
                    tr.appendChild(createTd(element.calculatedPricePerYear + " €"));
                    tr.appendChild(createTd(element.basicPrice + " €"));
                    tr.appendChild(createTd(Math.floor(element.pricePerUnit*10000)/100 + " ct"));
                    return tr;
                }
            </script>
            <label for="plz">PLZ:</label>
            <input type="number" name="plz" id="plz">

            <label for="consumption">Verbrauch pro Jahr:</label>
            <input type="number" name="consumption" id="consumption">
            <button
                onclick="doRequest(document.getElementById('plz').value, document.getElementById('consumption').value)">Jetzt
                berechnen</button>
        </section>
        <section id="output">

        </section>
    </div>
</body>

</Html>